<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç”»åƒæ¤œç´¢ãƒ†ã‚¹ãƒˆ</title>
    <style>
        body { 
            font-family: 'Hiragino Sans', 'ãƒ’ãƒ©ã‚®ãƒè§’ã‚´ Pro W3', 'Meiryo', sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        .test-container {
            background: rgba(255, 255, 255, 0.1);
            padding: 30px;
            border-radius: 15px;
            margin: 20px 0;
        }
        .test-result {
            margin: 15px 0;
            padding: 15px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
        }
        .performer-test {
            display: flex;
            align-items: center;
            margin: 10px 0;
            padding: 10px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
        }
        .performer-photo {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            margin-right: 15px;
            border: 3px solid rgba(255, 255, 255, 0.3);
        }
        .performer-info h3 {
            margin: 0;
            color: #ffd700;
        }
        .test-button {
            background: linear-gradient(45deg, #ff6b6b, #ffa500);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
            transition: transform 0.3s;
        }
        .test-button:hover {
            transform: scale(1.05);
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>ğŸŒŸ å®å¡šç”»åƒæ¤œç´¢ãƒ†ã‚¹ãƒˆ ğŸŒŸ</h1>
        <p>Webç”»åƒæ¤œç´¢æ©Ÿèƒ½ã‚’ãƒ†ã‚¹ãƒˆã—ã¾ã™ã€‚å„åŠ‡å›£å“¡ã®å†™çœŸã‚’æ¤œç´¢ãƒ»è¡¨ç¤ºã—ã¾ã™ã€‚</p>
        
        <button class="test-button" onclick="testAllPerformers()">å…¨åŠ‡å›£å“¡ãƒ†ã‚¹ãƒˆé–‹å§‹</button>
        <button class="test-button" onclick="testSinglePerformer()">å˜ä½“ãƒ†ã‚¹ãƒˆ</button>
        <button class="test-button" onclick="clearResults()">çµæœã‚¯ãƒªã‚¢</button>
        
        <div id="testResults"></div>
    </div>

    <script src="js/config.js"></script>
    <script src="js/data.js"></script>
    <script>
        class ImageSearchTester {
            constructor() {
                this.testResults = document.getElementById('testResults');
            }

            // ã‚·ãƒ³ãƒ—ãƒ«ãªãƒãƒƒã‚·ãƒ¥é–¢æ•°ï¼ˆapp.jsã‹ã‚‰ç§»æ¤ï¼‰
            simpleHash(str) {
                let hash = 0;
                for (let i = 0; i < str.length; i++) {
                    const char = str.charCodeAt(i);
                    hash = ((hash << 5) - hash) + char;
                    hash = hash & hash; // 32bitæ•´æ•°ã«å¤‰æ›
                }
                return Math.abs(hash);
            }

            // ç”»åƒæ¤œç´¢æ©Ÿèƒ½ï¼ˆapp.jsã‹ã‚‰ç§»æ¤ãƒ»ç°¡ç•¥åŒ–ï¼‰
            async searchPerformerPhoto(performer) {
                // è¤‡æ•°ã®ã‚½ãƒ¼ã‚¹ã‹ã‚‰å†™çœŸã‚’æ¤œç´¢ã—ã¦å–å¾—
                const queries = [
                    `${performer.name} å®å¡šæ­ŒåŠ‡å›£`,
                    `${performer.name} ã‚¿ã‚«ãƒ©ã‚¸ã‚§ãƒ³ãƒŒ`,
                    `${performer.name} ${performer.troupe}`,
                    `Takarazuka ${performer.name}`,
                    performer.name
                ];

                for (let i = 0; i < queries.length; i++) {
                    const query = queries[i];
                    
                    try {
                        // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆç”»åƒã‚’ãƒã‚§ãƒƒã‚¯
                        if (i === 0 && DEFAULT_PERFORMER_IMAGES[performer.name]) {
                            console.log(`${performer.name}ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆç”»åƒã‚’ä½¿ç”¨:`, DEFAULT_PERFORMER_IMAGES[performer.name]);
                            return DEFAULT_PERFORMER_IMAGES[performer.name];
                        }

                        // Unsplashæ¤œç´¢
                        let photoUrl = await this.searchUnsplashPhoto(query);
                        if (photoUrl) {
                            console.log(`Unsplashã§${performer.name}ã®å†™çœŸã‚’ç™ºè¦‹:`, photoUrl);
                            return photoUrl;
                        }

                        // Pixabayæ¤œç´¢
                        photoUrl = await this.searchPixabayPhoto(query);
                        if (photoUrl) {
                            console.log(`Pixabayã§${performer.name}ã®å†™çœŸã‚’ç™ºè¦‹:`, photoUrl);
                            return photoUrl;
                        }

                        // Lorem Picsum
                        if (i === 0) {
                            photoUrl = await this.searchLoremPicsumPhoto(performer);
                            if (photoUrl) {
                                console.log(`Lorem Picsumã§${performer.name}ç”¨ã®ç”»åƒã‚’ç”Ÿæˆ:`, photoUrl);
                                return photoUrl;
                            }
                        }

                    } catch (error) {
                        console.warn(`æ¤œç´¢ã‚¯ã‚¨ãƒª "${query}" ã§ã‚¨ãƒ©ãƒ¼:`, error);
                        continue;
                    }
                }

                return null;
            }

            async searchUnsplashPhoto(query) {
                if (query.includes('å®å¡š') || query.includes('ã‚¿ã‚«ãƒ©ã‚¸ã‚§ãƒ³ãƒŒ') || query.includes('Takarazuka')) {
                    const hash = this.simpleHash(query);
                    return IMAGE_SEARCH_CONFIG.unsplash.demoUrls[hash % IMAGE_SEARCH_CONFIG.unsplash.demoUrls.length];
                }
                return null;
            }

            async searchPixabayPhoto(query) {
                if (query.includes('å®å¡š') || query.includes('Takarazuka') || query.includes('ã‚¿ã‚«ãƒ©ã‚¸ã‚§ãƒ³ãƒŒ')) {
                    const hash = this.simpleHash(query);
                    return IMAGE_SEARCH_CONFIG.pixabay.demoUrls[hash % IMAGE_SEARCH_CONFIG.pixabay.demoUrls.length];
                }
                return null;
            }

            async searchLoremPicsumPhoto(performer) {
                if (DEFAULT_PERFORMER_IMAGES[performer.name]) {
                    return DEFAULT_PERFORMER_IMAGES[performer.name];
                }

                const seed = this.simpleHash(performer.name);
                const { min, max } = IMAGE_SEARCH_CONFIG.loremPicsum.idRange;
                const imageId = min + (seed % (max - min + 1));
                
                return `${IMAGE_SEARCH_CONFIG.loremPicsum.baseUrl}/id/${imageId}/150/150`;
            }

            generatePerformerAvatar(performer) {
                const seed = performer.name.replace(/\s/g, '-').toLowerCase();
                const bgColorMap = {
                    'tsuki': '2c3e50',
                    'hana': 'e74c3c',
                    'yuki': 'bdc3c7',
                    'hoshi': '1abc9c',
                    'sora': '3498db'
                };
                
                const bgColor = bgColorMap[performer.troupeColor] || '95a5a6';
                const hairStyle = performer.era === 'æ­´ä»£' ? 'longHair' : 'shortHair';
                const accessory = performer.era === 'æ­´ä»£' ? '&accessories[]=sunglasses' : '';
                
                return `https://avatars.dicebear.com/api/avataaars/${seed}.svg?background=%23${bgColor}&top[]=${hairStyle}${accessory}&clothesColor=blue01`;
            }

            async testPerformer(performer) {
                console.log(`ãƒ†ã‚¹ãƒˆé–‹å§‹: ${performer.name} (${performer.troupe})`);
                
                const photoUrl = await this.searchPerformerPhoto(performer);
                const fallbackUrl = this.generatePerformerAvatar(performer);
                
                return {
                    performer,
                    photoUrl: photoUrl || fallbackUrl,
                    foundPhoto: !!photoUrl,
                    source: photoUrl ? 'web search' : 'avatar'
                };
            }

            displayTestResult(result) {
                const resultDiv = document.createElement('div');
                resultDiv.className = 'performer-test';
                
                const eraIcon = result.performer.era === 'æ­´ä»£' ? 'ğŸ‘‘' : 'â­';
                const sourceIcon = result.foundPhoto ? 'ğŸ”' : 'ğŸ¨';
                
                resultDiv.innerHTML = `
                    <img class="performer-photo" src="${result.photoUrl}" alt="${result.performer.name}ã®å†™çœŸ" 
                         onerror="this.src='${this.generatePerformerAvatar(result.performer)}'">
                    <div class="performer-info">
                        <h3>${eraIcon} ${result.performer.name} (${result.performer.reading})</h3>
                        <p>ğŸ­ ${result.performer.troupe} | ${sourceIcon} ${result.source}</p>
                        <p style="font-size: 12px; opacity: 0.8;">${result.photoUrl}</p>
                    </div>
                `;
                
                this.testResults.appendChild(resultDiv);
            }
        }

        const tester = new ImageSearchTester();

        async function testAllPerformers() {
            tester.testResults.innerHTML = '<div class="test-result"><h2>ğŸ”„ å…¨åŠ‡å›£å“¡ãƒ†ã‚¹ãƒˆå®Ÿè¡Œä¸­...</h2></div>';
            
            let totalCount = 0;
            let foundCount = 0;
            
            for (const performer of TAKARAZUKA_PERFORMERS.slice(0, 10)) { // æœ€åˆã®10äººã‚’ãƒ†ã‚¹ãƒˆ
                const result = await tester.testPerformer(performer);
                tester.displayTestResult(result);
                
                totalCount++;
                if (result.foundPhoto) foundCount++;
                
                // å°‘ã—å¾…æ©Ÿï¼ˆè¡¨ç¤ºã®ç¢ºèªã®ãŸã‚ï¼‰
                await new Promise(resolve => setTimeout(resolve, 100));
            }
            
            const summaryDiv = document.createElement('div');
            summaryDiv.className = 'test-result';
            summaryDiv.innerHTML = `
                <h2>ğŸ“Š ãƒ†ã‚¹ãƒˆå®Œäº†</h2>
                <p>ãƒ†ã‚¹ãƒˆå¯¾è±¡: ${totalCount}äºº</p>
                <p>ç”»åƒæ¤œç´¢æˆåŠŸ: ${foundCount}äºº</p>
                <p>æˆåŠŸç‡: ${Math.round((foundCount / totalCount) * 100)}%</p>
            `;
            tester.testResults.insertBefore(summaryDiv, tester.testResults.firstChild);
        }

        async function testSinglePerformer() {
            const randomPerformer = TAKARAZUKA_PERFORMERS[Math.floor(Math.random() * TAKARAZUKA_PERFORMERS.length)];
            const result = await tester.testPerformer(randomPerformer);
            
            tester.testResults.innerHTML = '';
            const summaryDiv = document.createElement('div');
            summaryDiv.className = 'test-result';
            summaryDiv.innerHTML = `<h2>ğŸ¯ å˜ä½“ãƒ†ã‚¹ãƒˆçµæœ</h2>`;
            tester.testResults.appendChild(summaryDiv);
            
            tester.displayTestResult(result);
        }

        function clearResults() {
            tester.testResults.innerHTML = '';
        }

        // åˆæœŸè¡¨ç¤º
        window.addEventListener('load', () => {
            console.log('ç”»åƒæ¤œç´¢ãƒ†ã‚¹ãƒˆãƒšãƒ¼ã‚¸ãŒèª­ã¿è¾¼ã¾ã‚Œã¾ã—ãŸ');
            console.log('è¨­å®š:', IMAGE_SEARCH_CONFIG);
            console.log('åŠ‡å›£å“¡æ•°:', TAKARAZUKA_PERFORMERS.length);
        });
    </script>
</body>
</html>